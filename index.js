(function(){"use strict";const s=window.Vue;function m(){return window.panel}s.computed,s.customRef,s.defineAsyncComponent,s.defineComponent,s.effectScope,s.getCurrentInstance,s.getCurrentScope,s.h,s.inject,s.isProxy,s.isReactive,s.isReadonly,s.isRef,s.isShallow,s.markRaw,s.nextTick,s.onActivated,s.onBeforeMount,s.onBeforeUnmount,s.onBeforeUpdate,s.onDeactivated,s.onErrorCaptured,s.onMounted,s.onRenderTracked,s.onRenderTriggered,s.onScopeDispose,s.onServerPrefetch,s.onUnmounted,s.onUpdated,s.provide,s.proxyRefs,s.reactive,s.readonly,s.ref,s.shallowReactive,s.shallowReadonly,s.shallowRef,s.toRaw,s.toRef,s.toRefs,s.triggerRef,s.unref,s.useAttrs,s.useCssModule,s.useCssVars,s.useListeners,s.useSlots,s.watch,s.watchEffect,s.watchPostEffect,s.watchSyncEffect;function u(t){const e=m();for(const i of t){if(!this[i]){e.debug&&window.console.warn("Native function replacement hack: `"+i+"` doesn't exist anymore. Please fix me.");continue}if(!this[i+"Custom"]){e&&window.console.warn("Native function replacement hack: `"+i+"Custom` doesn't exist. Please implement it !");continue}this[i+"Native"]||(this[i+"Native"]=this[i],this[i]=this[i+"Custom"])}}({...u});const z="";function c(t,e,i,o,n,l,h,M){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=i,r._compiled=!0),o&&(r.functional=!0),l&&(r._scopeId="data-v-"+l);var d;if(h?(d=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__<"u"&&(a=__VUE_SSR_CONTEXT__),n&&n.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(h)},r._ssrRegister=d):n&&(d=M?function(){n.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:n),d)if(r.functional){r._injectStyles=d;var U=r.render;r.render=function(j,f){return d.call(f),U(j,f)}}else{var p=r.beforeCreate;r.beforeCreate=p?[].concat(p,d):[d]}return{exports:t,options:r}}var g=c({name:"k-taxonomystructure-field",extends:"k-structure-field",props:{keyfieldname:{type:String,default:"id"},allowremove:{type:Boolean,default:!1}},mounted:function(){this.invertCustomAndNativeFunctions(["open","removeAll","remove"])},methods:{invertCustomAndNativeFunctions:u,openCustom(t,e,i=!1){return this.fields.id.disabled=!this.$helper.string.isEmpty(t[this.keyfieldname??"id"]),this.openNative(t,e,i)},removeCustom(t){(this.allowremove||this.$helper.string.isEmpty(t[this.keyfieldname??"id"]))&&this.removeNative(t)},removeAllCustom(){this.allowremove&&this.removeAllNative()},optionCustom(t,e){this.duplicate==!1&&t=="duplicate"||this.optionNative(t,e)},optionsNative(){return this.disabled?[]:[{icon:"edit",text:this.$t("edit"),click:"edit"},{disabled:!this.duplicate||!this.more,icon:"copy",text:this.$t("duplicate"),click:"duplicate"},"-",{icon:"trash",text:this.$t("delete"),click:"remove"}]}},computed:{options(){let t=this.optionsNative();return this.duplicate||(t=t.filter(e=>e.icon!=="copy")),this.allowremove==!1&&(t=t.filter(e=>e.icon!=="trash"&&e!=="-")),t}}},null,null,!1,null,null,null,null);const _=g.exports,v={props:{disabled:Boolean}},b={props:{help:String}},$={props:{id:{type:[Number,String],default(){return this._uid}}}},y={props:{label:[String,Boolean]}},x={props:{name:[Number,String]}},k={props:{required:Boolean}},q="",S={mixins:[v,b,$,y,x,k],props:{counter:[Boolean,Object],endpoints:Object,input:{type:[String,Number,Boolean],default:null},translate:Boolean,type:String}},w={data:()=>({isSelecting:!1,selected:[]}),created(){this.$events.on(this.batchEditingEvent,this.stopSelectingCollision)},destroyed(){this.$events.off(this.batchEditingEvent,this.stopSelectingCollision)},computed:{batchDeleteConfirmMessage(){return this.$t(`${this.type}.delete.confirm.selected`,{count:this.selected.length})},batchEditingButtons(){const t=[];return t.push({disabled:this.selected.length===0,icon:"trash",text:this.$t("delete")+` (${this.selected.length})`,theme:"negative",click:()=>{this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.batchDeleteConfirmMessage},on:{submit:async()=>{this.$panel.dialog.close(),this.selected.length!==0&&(await this.onBatchDelete(),this.stopSelecting())}}})},responsive:!0}),t.push({icon:"cancel",text:this.$t("cancel"),click:this.onSelectToggle,responsive:!0}),t},batchEditingEvent(){return"selecting"},batchEditingIdentifier(){return"id"},batchEditingToggle(){return{icon:"checklist",click:this.onSelectToggle,title:this.$t("select"),responsive:!0}},canSelect(){return!0}},methods:{onBatchDelete(){throw new Error("Not implemented")},onSelect(t){this.selected.includes(t)?this.selected=this.selected.filter(e=>e[this.batchEditingIdentifier]!==t[this.batchEditingIdentifier]):this.selected.push(t)},onSelectToggle(){this.isSelecting?this.stopSelecting():this.startSelecting()},startSelecting(){this.isSelecting=!0,this.selected=[],this.$events.emit(this.batchEditingEvent,this.name)},stopSelecting(){this.isSelecting=!1,this.selected=[]},stopSelectingCollision(t){t!==this.name&&this.stopSelecting()}}},X="",E={mixins:[S,w],inheritAttrs:!1,props:{autofocus:Boolean,batch:{type:Boolean,default:!1},columns:Object,duplicate:{type:Boolean,default:!0},empty:String,fields:[Array,Object],limit:Number,max:Number,min:Number,prepend:{type:Boolean,default:!1},sortable:{type:Boolean,default:!0},sortBy:String,value:{type:Array,default:()=>[]}},data(){return{items:[],page:1}},computed:{batchDeleteConfirmMessage(){return this.$t("field.structure.delete.confirm.selected",{count:this.selected.length})},batchEditingEvent(){return"structure.selecting"},batchEditingIdentifier(){return"_id"},canSelect(){return this.batch===!0&&this.items.length>0},index(){return this.limit?(this.page-1)*this.limit+1:1},hasFields(){return this.$helper.object.length(this.fields)>0},isSortable(){return!(this.sortBy||this.limit||this.disabled===!0||this.items.length<=1||this.sortable===!1)},more(){return!(this.disabled===!0||this.max&&this.items.length>=this.max)},options(){return this.disabled?[]:[{icon:"edit",text:this.$t("edit"),click:"edit"},{disabled:!this.duplicate||!this.more,icon:"copy",text:this.$t("duplicate"),click:"duplicate"},"-",{icon:"trash",text:this.$t("delete"),click:"remove"}]},paginatedItems(){return this.limit?this.items.slice(this.pagination.offset,this.pagination.offset+this.limit):this.items},pagination(){let t=0;return this.limit&&(t=(this.page-1)*this.limit),{page:this.page,offset:t,limit:this.limit,total:this.items.length,align:"center",details:!0}}},watch:{value:{handler(t){this.stopSelecting(),t!==this.items&&(this.items=this.toItems(t))},immediate:!0}},methods:{add(t=null){if(this.more===!1)return!1;t??(t=this.$helper.field.form(this.fields)),t._id??(t._id=this.$helper.uuid()),this.prepend===!0?this.items.unshift(t):this.items.push(t),this.save(),this.open(t)},close(){this.$panel.drawer.close(this.id)},focus(){var t,e;(e=(t=this.$refs.add)==null?void 0:t.focus)==null||e.call(t)},form(t){const e=this.$helper.field.subfields(this,this.fields);if(t)for(const i in e)e[i].autofocus=i===t;return e},findIndex(t){return this.items.findIndex(e=>e._id===t._id)},navigate(t,e){const i=this.findIndex(t);i!==-1&&this.open(this.items[i+e],null,!0)},open(t,e,i=!1){const o=this.findIndex(t);if(o===-1)return!1;this.stopSelecting(),this.$panel.drawer.open({component:"k-structure-drawer",id:this.id,props:{disabled:this.disabled,icon:this.icon??"list-bullet",next:this.items[o+1],prev:this.items[o-1],tabs:{content:{fields:this.form(e)}},title:this.label,value:t},replace:i,on:{input:n=>{const l=this.findIndex(t);this.$panel.drawer.props.next=this.items[l+1],this.$panel.drawer.props.prev=this.items[l-1],this.$set(this.items,l,n),this.save()},next:()=>{this.navigate(t,1)},prev:()=>{this.navigate(t,-1)},remove:()=>{this.remove(t)}}})},option(t,e){switch(t){case"remove":this.remove(e);break;case"duplicate":this.add({...this.$helper.object.clone(e),_id:this.$helper.uuid()});break;case"edit":this.open(e);break}},onBatchDelete(){this.removeSelected()},onTableInput(t){this.limit&&(t=this.items.toSpliced(this.pagination.offset,this.limit,...t)),this.save(t)},paginate({page:t}){this.page=t,this.stopSelecting()},remove(t){const e=this.findIndex(t);this.disabled||e===-1||this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.structure.delete.confirm")},on:{submit:()=>{this.items.splice(e,1),this.save(),this.$panel.dialog.close(),this.close(),this.paginatedItems.length===0&&this.page>1&&this.page--}}})},removeAll(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.structure.delete.confirm.all")},on:{submit:()=>{this.page=1,this.items=[],this.save(),this.$panel.dialog.close()}}})},removeSelected(){this.items=this.items.filter(t=>!this.selected.includes(t)),this.save()},save(t=this.items){this.$emit("input",t)},sort(t){return this.sortBy?this.$helper.array.sortBy(t,this.sortBy):t},toItems(t){return Array.isArray(t)===!1?[]:(t=t.map(e=>({_id:e._id??this.$helper.uuid(),...e})),this.sort(t))}}};var C=function(){var e=this,i=e._self._c;return i("k-field",e._b({class:["k-structure-field",e.$attrs.class],style:e.$attrs.style,attrs:{input:e.id},nativeOn:{click:function(o){o.stopPropagation()}},scopedSlots:e._u([e.hasFields&&!e.disabled?{key:"options",fn:function(){return[e.isSelecting?i("k-button-group",{attrs:{buttons:e.batchEditingButtons,size:"xs",variant:"filled"}}):i("k-button-group",[e.canSelect?[i("k-button",e._b({attrs:{size:"xs",variant:"filled"}},"k-button",e.batchEditingToggle,!1))]:e._e(),i("k-button-group",{attrs:{layout:"collapsed"}},[i("k-button",{attrs:{autofocus:e.autofocus,disabled:!e.more,responsive:!0,text:e.$t("add"),icon:"add",variant:"filled",size:"xs"},on:{click:function(o){return e.add()}}}),i("k-button",{attrs:{icon:"dots",size:"xs",variant:"filled"},on:{click:function(o){return e.$refs.options.toggle()}}}),i("k-dropdown-content",{ref:"options",attrs:{options:[{click:()=>e.add(),disabled:!e.more,icon:"add",text:e.$t("add")},{click:()=>e.removeAll(),disabled:e.items.length===0||e.disabled,icon:"trash",text:e.$t("delete.all")}],"align-x":"end"}})],1)],2)]},proxy:!0}:null],null,!0)},"k-field",e.$props,!1),[i("k-input-validator",e._b({attrs:{value:JSON.stringify(e.items)}},"k-input-validator",{id:e.id,min:e.min,max:e.max,required:e.required},!1),[e.hasFields?[e.items.length===0?i("k-empty",{attrs:{icon:"list-bullet"},on:{click:function(o){return e.add()}}},[e._v(" "+e._s(e.empty??e.$t("field.structure.empty"))+" ")]):[i("k-table",{attrs:{columns:e.columns,disabled:e.disabled,fields:e.fields,empty:e.$t("field.structure.empty"),index:e.index,options:e.options,pagination:e.limit&&!e.isSelecting?e.pagination:!1,rows:e.paginatedItems,selecting:e.isSelecting,sortable:e.isSortable},on:{cell:function(o){return e.open(o.row,o.columnIndex)},input:e.onTableInput,option:e.option,paginate:e.paginate,select:e.onSelect}}),e.more?i("footer",[i("k-button",{attrs:{title:e.$t("add"),icon:"add",size:"xs",variant:"filled"},on:{click:function(o){return e.add()}}})],1):e._e()]]:[i("k-empty",{attrs:{icon:"list-bullet"}},[e._v(e._s(e.$t("fields.empty")))])]],2)],1)},T=[],N=c(E,C,T,!1,null,null,null,null);const B=N.exports,J="",F={name:"k-taxonomy-tags-field",extends:"k-tags-field",inheritAttrs:!1,mixins:[{methods:{getForm:B.methods.form}}],inheritAttrs:!0,created(){},data(){return{isEditing:!1,currentIndex:null,currentModel:null,newOptions:null,newEntryValue:null}},props:{fields:Object,taxonomybindings:Object,taxonomyEndpoint:String,taxonomyEditUrl:String,taxonomyIsOnSameModel:Boolean,structureFieldName:String,keyfieldname:{type:String,default:"id"}},methods:{add(){this.newEntryValue=this.$helper.field.form(this.fields),this.open(this.newEntryValue)},close(){this.$panel.drawer.close(this.id+"_drawer")},open(t,e=null,i=!1){if(this.disabled===!0)return!1;this.fields.id.disabled=!this.$helper.string.isEmpty(t[this.keyfieldname??"id"]),this.$panel.drawer.open({component:"k-structure-drawer",id:this.id+"_drawer",props:{icon:this.icon??"list-bullet",tabs:{content:{fields:this.getForm(null)}},title:this.label,value:t},replace:i,on:{submit:o=>(this.$api.post(this.endpoints.field+"/addTag",{newTag:o},null,!0).then(n=>{if(n.code==200&&n.status=="success"&&n.data&&n.data.newTag){if(n.data.options&&(this.newOptions=n.data.options),this.$set(this.value,this.value.length,n.data.newTag.value),this.$emit("input",this.value),this.$panel.notification.open(n),this.close(),n.data.newStructureContent&&this.taxonomyIsOnSameModel){let l=n.data.structureFieldName??this.structureFieldName;l&&!this.$helper.string.isEmpty(l)&&this.$panel.content.update({[l]:n.data.newStructureContent})}}else response.errors?this.$panel.error(response.errors,!0):this.$panel.error(n,!0)}).catch(n=>(n.details?this.$panel.dialog.open({component:"k-error-dialog",props:n}):n.message?this.$panel.error(n,!0):this.$panel.error({message:"There was an error adding the tag !",details:error},!0),!1)),!0),remove:()=>{this.close()}}})},edit(t,e,i){window.console.log("Editing!=",t,e,i)},hasFields(){return this.$helper.object.length(this.fields)>0},addTag(t){this.$nextTick(()=>{var e,i,o,n,l;(i=(e=this.$refs.input)==null?void 0:e.$refs.input)==null||i.addTag(t),(n=(o=this.$refs.input)==null?void 0:o.$refs.input)==null||n.onInput(),(l=this.$refs.form)==null||l.focus(t.value)})},async validate(t){const e=await this.$api.post(this.taxonomyEndpoint+"/validate",t);if(e.length>0)throw e;return!0}},computed:{hasTaxonomyBinding(){return!!this.taxonomybindings.field},form(){return this.$helper.field.subfields(this,this.fields)},more(){return!(this.disabled===!0||this.max&&this.items.length>=this.max)},computedOptions(){return(this.newOptions??this.options??[]).map(function(t){return!t.image&&!window.panel.app.$helper.string.isEmpty(t.icon)&&(t.image={type:"icon",icon:t.icon}),t})}}};var I=function(){var e=this,i=e._self._c;return i("k-field",e._b({class:["k-tags-field",e.$attrs.class],style:e.$attrs.style,attrs:{counter:e.counterOptions,input:e.id},scopedSlots:e._u([e.hasFields&&!e.disabled?{key:"options",fn:function(){return[i("k-button-group",{attrs:{layout:"collapsed"}},[i("k-text",{staticClass:"k-text k-help"},[i("p",[e._v("Taxonomy: ")])]),i("k-button",{attrs:{autofocus:e.autofocus,disabled:!e.more,responsive:!0,text:e.$t("add"),icon:"add",variant:"filled",size:"xs"},on:{click:function(o){return e.add()}}}),e.taxonomyEditUrl&&!e.taxonomyIsOnSameModel?i("k-button",{attrs:{autofocus:!1,responsive:!0,text:e.$t("edit"),icon:"edit",variant:"filled",size:"xs"},on:{click:function(o){return e.$panel.open(e.taxonomyEditUrl)}}}):e._e()],1)]},proxy:!0}:null],null,!0)},"k-field",e.$props,!1),[e.hasNoOptions?i("k-empty",{attrs:{icon:e.icon,text:e.$t("options.none")}}):i("k-input",e._b({ref:"input",attrs:{options:e.computedOptions,type:"tags"},on:{input:function(o){return e.$emit("input",o)},edit:function(o){return e.edit(e.index,e.tag,o)}}},"k-input",e.$props,!1))],1)},R=[],O=c(F,I,R,!1,null,null,null,null);const A=O.exports,L="";panel.plugin("daandelange/taxonomy",{components:{"k-structure-field-mixin":{extends:"k-structure-field"}},fields:{taxonomystructure:_,taxonomytags:A}})})();
